# TTS语音播报功能使用说明

## 概述
ASR-LLM-TTS智能助手集成了阿里云DashScope的CosyVoice v2语音合成技术，提供高质量的中文语音播报功能。

## 功能特性

### 1. 自动语音播报
- **位置**: 左侧边栏 "音频功能" 区域
- **按钮**: "开启语音" / "关闭语音"
- **功能**: 当启用自动语音播报时，AI助手的每个回复都会自动播放语音

**使用方法**:
1. 点击左侧边栏中的 "开启语音" 按钮
2. 按钮变为绿色并显示 "关闭语音"
3. 之后所有AI回复都会自动播放语音
4. 再次点击可关闭自动播报

### 2. 手动语音播报
- **位置**: 每条AI回复消息下方的操作按钮
- **按钮**: 🔊 朗读
- **功能**: 针对特定AI回复进行语音播报

**使用方法**:
1. 在AI回复消息下方找到 "🔊 朗读" 按钮
2. 点击按钮即可播放该条回复的语音
3. 无需预先开启自动语音播报

### 3. 支持的语音
当前支持的CosyVoice v2语音包括：
- **longxiaochun_v2**: 龙小春 - 女声（默认）
- **longxiaoxia_v2**: 龙小夏 - 女声
- **longwan_v2**: 龙万 - 男声
- **longcheng_v2**: 龙城 - 男声
- **longhua_v2**: 龙华 - 男声
- **longshu_v2**: 龙书 - 男声
- **loongbella_v2**: Bella - 女声

## 技术实现

### 后端API
- **端点**: `/tts`
- **方法**: POST
- **参数**:
  ```json
  {
    "text": "要播报的文本",
    "voice": "longxiaochun_v2"
  }
  ```
- **返回**: Base64编码的MP3音频数据

### 前端播放
- 使用JavaScript的`Audio`对象播放音频
- 自动处理Base64解码和Blob转换
- 支持音频资源的自动清理

## 使用技巧

### 1. 最佳实践
- **短文本**: 对于较短的回复，语音播报效果最佳
- **网络环境**: 确保网络连接稳定，语音合成需要调用云API
- **浏览器支持**: 建议使用Chrome、Firefox、Edge等现代浏览器

### 2. 注意事项
- 语音合成需要消耗阿里云DashScope API额度
- 首次使用时可能需要授权浏览器播放音频
- 长文本会自动进行清理和优化以提高合成质量

### 3. 故障排除
- **无声音**: 检查浏览器音量设置和音频权限
- **播放失败**: 检查网络连接和API密钥配置
- **音质问题**: 尝试更换不同的语音模型

## 界面操作流程

### 场景1: 开启自动播报
```
1. 打开网页 → 2. 点击左侧"开启语音" → 3. 发送消息 → 4. AI回复自动播放语音
```

### 场景2: 手动播报特定回复
```
1. 查看AI回复 → 2. 点击消息下方"🔊 朗读"按钮 → 3. 播放该条回复的语音
```

### 场景3: 语音识别+语音播报完整流程
```
1. 点击"开始录音" → 2. 说话并停止录音 → 3. 识别结果填入输入框 → 4. 点击发送 → 5. AI回复自动播放语音
```

## 代码实现细节

### 前端JavaScript (app.js)
```javascript
// 自动TTS开关
function toggleTTS() {
    isTTSEnabled = !isTTSEnabled;
    // 更新按钮状态
}

// 手动TTS播放
async function speakText(text) {
    // 调用后端TTS API
    // 处理音频播放
}
```

### 后端Flask (app_simple.py)
```python
@app.route('/tts', methods=['POST'])
def text_to_speech():
    data = request.json
    text = data.get('text', '')
    voice = data.get('voice', 'longxiaochun_v2')
    
    # 调用TTS服务
    audio_data = tts_service.synthesize(text, voice)
    # 返回Base64编码的音频
```

## 常见问题解答

**Q: 为什么有时候语音播报没有声音？**
A: 请检查：1) 浏览器音量设置 2) 网络连接 3) 是否授权了音频播放权限

**Q: 可以更换语音吗？**
A: 目前默认使用龙小春女声，如需更换其他语音，需要修改代码中的voice参数

**Q: 语音播报会消耗流量吗？**
A: 是的，语音合成需要调用云API，会消耗网络流量和API额度

**Q: 支持英文语音播报吗？**
A: 当前主要优化中文播报，英文内容也可以播报但效果可能不如中文

## 更新日志
- **v1.0.0**: 基础TTS功能实现
- **v1.1.0**: 添加自动播报开关
- **v1.2.0**: 支持手动播报特定回复
- **v1.3.0**: 优化音频播放和资源管理
- **v1.4.0**: 升级到CosyVoice v2模型

---

*如有其他问题或建议，请联系开发团队*
